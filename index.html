<!DOCTYPE html>
<html>
<head>
    <title>Domain Consensus</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <style>
        body {
            font-family: monospace;
            margin: 0;
            padding: 0;
            background: #f8f4f0;
            font-size: 19px;
        }
        #main {
            max-width: 640px;
            background: white;
            margin: 20px;
            padding: 25px;
            border-radius: 3px;
            border: solid thin #eee;
            box-shadow: 5px 5px 30px 4px #dedede;
        }
        #sponsor {
            background: #ddffee;
            padding: 10px;
        }
        #sponsor button {
            padding: 8px 10px;
            border-radius: 4px;
            border: solid thin green;
            cursor: pointer;
            margin-top: 10px;
        }
        #sponsor button:hover {
            border: solid thin lightgreen;
        }

        .ads-opt-in-inline, .ads-opt-in-block {
            display: none;
        }

        .ads-opt-in .ads-opt-in-hide {
            display: none;
        }
        .ads-opt-in .ads-opt-in-inline {
            display: inline;
        }
        .ads-opt-in .ads-opt-in-block {
            display: block;
        }

        table {
            width: 100%;
        }

        table th {
            text-align: center;
        }

        table th, table td {
            background: #eeeeee;
            padding: 3px;
            border: solid thick white;
        }

        #stems-index td {
            text-align: right;
        }

        #stems-index td.stems-index-stem {
            text-align: left;
            color: #002288;
            text-decoration: underline;
            cursor: pointer;
        }

        .chart-loading-show {
            display: none;
        }
        .chart-loading-hide {
            display: block;
        }
        .chart-loading .chart-loading-show  {
            display: block;
        }
        .chart-loading .chart-loading-hide {
            display: none;
        }
    </style>
    <link rel="stylesheet" href="/modals.min.css">
    <script src="/modals.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8311301439241235"
    crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.8.0/chart.min.js" integrity="sha512-sW/w8s4RWTdFFSduOTGtk4isV1+190E/GghVffMA9XczdJ2MDzSzLEubKAs5h0wzgSJOQTRYyaz73L3d6RtJSg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        function showAds() {
            document.body.classList.add("ads-opt-in")
            var ad_el = document.getElementById("ad")
            ad_el.innerHTML = '<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-8311301439241235" data-ad-slot="4833581514" data-ad-format="auto" data-full-width-responsive="true"></ins>';
            (adsbygoogle = window.adsbygoogle || []).push({});
        }

        var chartCtx = null;
        var myChart = null;

        function loadCrypto() {
            document.body.classList.add("chart-loading");
            chartCtx = document.getElementById('myChart');
            if (myChart !== null) {
                myChart.destroy();
            }
            axios.get("/data/crypto.json").then(function (resp) {
                console.log(resp.data);
                myChart = new Chart(chartCtx, {
                    type: "line",
                    data: {
                        labels: resp.data[0],
                        datasets:[
                            {
                                label: "Crypto",
                                data: resp.data[1],
                                borderColor: 'rgb(75, 192, 192)',
                            },
                        ],
                    },
                });

                document.body.classList.remove("chart-loading");
            })
            modals.openModal( null, '#modal' );
            return false;
        }

        function loadChart(stem, hash) {
            document.body.classList.add("chart-loading");
            chartCtx = document.getElementById('myChart');
            if (myChart !== null) {
                myChart.destroy();
            }
            axios.get("/data/" + hash + ".json").then(function (resp) {
                console.log(resp.data);
                myChart = new Chart(chartCtx, {
                    type: "line",
                    data: {
                        labels: resp.data[0],
                        datasets:[
                            {
                                label: stem,
                                data: resp.data[1],
                                borderColor: 'rgb(75, 192, 192)',
                            },
                        ],
                    },
                });

                document.body.classList.remove("chart-loading");
            })
            modals.openModal( null, '#modal' );
            return false;
        }

        function closeChart() {
            modals.closeModal();
        }

        function loadMeta() {
            axios.get("/data/meta.json").then(function (res) {
                console.log(res.data)

                var stemsIndexEl = document.getElementById("stems-index")

                for(var i = 0; i < res.data.length; i++) {
                    var row = res.data[i]
                    var rowEl = document.createElement("tr")

                    var labelEl = document.createElement("td", )
                    labelEl.classList.add("stems-index-stem")
                    labelEl.appendChild(
                        document.createTextNode(row.stem)
                    )
                    const stem = row.stem;
                    const hashed = row.hashed
                    labelEl.onclick = function(ev) {
                        loadChart(stem, hashed);
                        return false;
                    }

                    var changeEl = document.createElement("td", )
                    changeEl.classList.add("stems-index-change")
                    changeEl.appendChild(
                        document.createTextNode(row.change.toFixed(2))
                    )

                    var scoreTodayEl = document.createElement("td", )
                    scoreTodayEl.classList.add("stems-index-score-today")
                    scoreTodayEl.appendChild(
                        document.createTextNode((row.score_today * 10000).toFixed(2))
                    )

                    rowEl.appendChild(labelEl)
                    rowEl.appendChild(changeEl)
                    rowEl.appendChild(scoreTodayEl)
                    stemsIndexEl.appendChild(rowEl)
                }

            })

        }

        loadMeta()
    </script>
</head>
<body>
    <div id="main">
        <h1>Domain Consensus</h1>
        <p>
            <strong>Insights from newly registered domains.</strong>
        </p>
        <p>
            Registration of a domain name represents someone's investment and
            insight to enguage with people around a particular message. Domain
            Consensus is about tracking the value of messages over time.
        </p>
        <div id="sponsor">
            <span class="ads-opt-in-hide">Domain Consensus is Free.</span>
            <span id="sponsor-turn-on" class="ads-opt-in-hide">
                <br/><button onclick="showAds();">Show sponsored link</button>
                to help us out.
            </span>
            <span class="ads-opt-in-inline">
                Thanks!<br/>
            </span>
            <div id="ad" class="ads-opt-in-block">
                <i>Ad content here</i>
            </div>
        </div>
        <hr/>
        <h2>Topics in Newly Registered Domains</h2>
        <p>Trends on groups of terms as they appeare in newly registered domains.</p>
        <ul>
            <li><a href="#" onclick="loadCrypto()">Cryptocurrency and Bitcoin</a></li>
        </ul>

        <hr/>
        <h2>Word Stems in Newly Registered Domains</h2>
        <p>Word stem score from occurances found in domains registered today (5th July 2022)</p>
        <table>
            <thead>
                <tr>
                    <th>
                        Word Stem
                    </th>
                    <th>
                        Change
                    </th>
                    <th>
                        Score
                    </th>
                </tr>
            </thead>
            <tbody id="stems-index">
            </tbody>
        </table>
        <div class="modal" data-modal-window id="modal">
            <a class="close" onclick="closeChart()">x</a>
            <p class="chart-loading-show">Loading...</p>
            <div class="chart-loading-hide">
                <canvas id="myChart" width="400" height="100"></canvas>
            </div>
        </div>
    </div>
    <script>
       //modals.init();
    </script>
</body>
</html>